#!/usr/bin/env python3
"""
OpenClaw — Figure 03 : HEATMAP
========================================
Generates Figure03_HEATMAP_FR.png and Figure03_HEATMAP_EN.png

EDIT: Change text directly in SVG_FR / SVG_EN below.

Usage:
    python3 fig03_heatmap.py              # FR + EN
    python3 fig03_heatmap.py fr           # FR only
    python3 fig03_heatmap.py en           # EN only

Requires: pip install cairosvg
"""

import os, sys

try:
    import cairosvg
except ImportError:
    print("pip install cairosvg")
    sys.exit(1)

OUTPUT_DIR = os.path.join(os.path.dirname(os.path.abspath(__file__)), "openclaw_figures")
DPI = 300
WIDTH = 3600

# ────────────────────────────────────────────────────────────
# SVG FRANÇAIS (modifiable)
# ────────────────────────────────────────────────────────────
SVG_FR = (
    '<?xml version="1.0" encoding="UTF-8"?>\n'
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="520" viewBox="0 0 900 520">\n'
    '  <style>\n'
    '    text { font-family: "Times New Roman", Times, serif; }\n'
    '    .title { font-size: 11px; font-weight: bold; text-anchor: middle; }\n'
    '    .tactic { font-size: 7.5px; font-weight: bold; text-anchor: middle; fill: #000; }\n'
    '    .tech { font-size: 6.5px; text-anchor: middle; fill: #333; font-family: "Courier New", monospace; }\n'
    '    .cell { stroke: #fff; stroke-width: 0.5; }\n'
    '    .caption { font-size: 10px; text-anchor: start; }\n'
    '    .legend { font-size: 7.5px; text-anchor: start; fill: #333; }\n'
    '    .atlas-label { font-size: 6.5px; text-anchor: middle; fill: #333; font-style: italic; }\n'
    '  </style>\n'
    '\n'
    '  <text x="450" y="20" class="title">COUVERTURE MITRE ATT&amp;CK / ATLAS — OPÉRATION OPENCLAW</text>\n'
    '  <line x1="20" y1="28" x2="880" y2="28" stroke="#000" stroke-width="0.6"/>\n'
    '\n'
    '  <!-- 14 ATT&CK Tactics as columns -->\n'
    '  <!-- Col width ~58px, starting at x=30 -->\n'
    '  \n'
    '  <!-- Tactic headers -->\n'
    '  <text x="59" y="50" class="tactic">Recon.</text>\n'
    '  <text x="117" y="50" class="tactic">Res. Dev.</text>\n'
    '  <text x="175" y="50" class="tactic">Init. Acc.</text>\n'
    '  <text x="233" y="50" class="tactic">Execution</text>\n'
    '  <text x="291" y="50" class="tactic">Persist.</text>\n'
    '  <text x="349" y="50" class="tactic">Priv. Esc.</text>\n'
    '  <text x="407" y="50" class="tactic">Def. Ev.</text>\n'
    '  <text x="465" y="50" class="tactic">Cred. Acc.</text>\n'
    '  <text x="523" y="50" class="tactic">Discovery</text>\n'
    '  <text x="581" y="50" class="tactic">Lat. Mov.</text>\n'
    '  <text x="639" y="50" class="tactic">Collection</text>\n'
    '  <text x="697" y="50" class="tactic">C2</text>\n'
    '  <text x="755" y="50" class="tactic">Exfiltrat.</text>\n'
    '  <text x="813" y="50" class="tactic">Impact</text>\n'
    '\n'
    '  <!-- Phase 1 techniques (Reconnaissance) -->\n'
    '  <rect x="30" y="58" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="72" class="tech">T1593</text>\n'
    '  <rect x="30" y="80" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="94" class="tech">T1595</text>\n'
    '  <rect x="30" y="102" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="116" class="tech">T1596</text>\n'
    '  <rect x="30" y="124" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="138" class="tech">T1589</text>\n'
    '\n'
    '  <!-- Phase 2 (Resource Development) -->\n'
    '  <rect x="88" y="58" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="72" class="tech">T1587.001</text>\n'
    '  <rect x="88" y="80" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="94" class="tech">T1588.002</text>\n'
    '  <rect x="88" y="102" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="116" class="tech">T1608</text>\n'
    '\n'
    '  <!-- Phase 3 (Initial Access) -->\n'
    '  <rect x="146" y="58" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="72" class="tech">T1195.002</text>\n'
    '  <rect x="146" y="80" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="94" class="tech">T1078</text>\n'
    '  <rect x="146" y="102" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="116" class="tech">T1190</text>\n'
    '\n'
    '  <!-- Execution -->\n'
    '  <rect x="204" y="58" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="233" y="72" class="tech">T1059</text>\n'
    '  <rect x="204" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="233" y="94" class="tech">T1204.002</text>\n'
    '\n'
    '  <!-- Persistence -->\n'
    '  <rect x="262" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="291" y="72" class="tech">T1546</text>\n'
    '  <rect x="262" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="291" y="94" class="tech">T1547</text>\n'
    '\n'
    '  <!-- Privilege Escalation -->\n'
    '  <rect x="320" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="349" y="72" class="tech">T1484.001</text>\n'
    '  <rect x="320" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="349" y="94" class="tech">T1558.001</text>\n'
    '\n'
    '  <!-- Defense Evasion -->\n'
    '  <rect x="378" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="407" y="72" class="tech">T1070</text>\n'
    '  <rect x="378" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="407" y="94" class="tech">T1036</text>\n'
    '\n'
    '  <!-- Credential Access -->\n'
    '  <rect x="436" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="72" class="tech">T1003.001</text>\n'
    '  <rect x="436" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="94" class="tech">T1003.006</text>\n'
    '  <rect x="436" y="102" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="116" class="tech">T1528</text>\n'
    '\n'
    '  <!-- Discovery -->\n'
    '  <rect x="494" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="72" class="tech">T1018</text>\n'
    '  <rect x="494" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="94" class="tech">T1083</text>\n'
    '  <rect x="494" y="102" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="116" class="tech">T1135</text>\n'
    '\n'
    '  <!-- Lateral Movement -->\n'
    '  <rect x="552" y="58" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="581" y="72" class="tech">T1021.002</text>\n'
    '  <rect x="552" y="80" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="581" y="94" class="tech">T1021.006</text>\n'
    '\n'
    '  <!-- Collection -->\n'
    '  <rect x="610" y="58" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="639" y="72" class="tech">T1005</text>\n'
    '  <rect x="610" y="80" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="639" y="94" class="tech">T1560</text>\n'
    '\n'
    '  <!-- C2 -->\n'
    '  <rect x="668" y="58" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="697" y="72" class="tech">T1071.001</text>\n'
    '  <rect x="668" y="80" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="697" y="94" class="tech">T1573</text>\n'
    '\n'
    '  <!-- Exfiltration -->\n'
    '  <rect x="726" y="58" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="755" y="72" class="tech">T1041</text>\n'
    '\n'
    '  <!-- Impact -->\n'
    '  <rect x="784" y="58" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="72" class="tech">T1486</text>\n'
    '  <rect x="784" y="80" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="94" class="tech">T1490</text>\n'
    '  <rect x="784" y="102" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="116" class="tech">T1657</text>\n'
    '  <rect x="784" y="124" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="138" class="tech">T1491.001</text>\n'
    '\n'
    '  <!-- ATLAS section -->\n'
    '  <line x1="20" y1="160" x2="880" y2="160" stroke="#000" stroke-width="0.5" stroke-dasharray="3,2"/>\n'
    '  <text x="450" y="178" class="tactic" style="font-size:8px;">MITRE ATLAS (techniques spécifiques IA)</text>\n'
    '\n'
    '  <rect x="88" y="188" width="116" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="146" y="202" class="tech">AML.T0048</text>\n'
    '  <text x="146" y="212" class="atlas-label">Backdoor ML model</text>\n'
    '\n'
    '  <rect x="204" y="188" width="116" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="262" y="202" class="tech">AML.T0051</text>\n'
    '  <text x="262" y="212" class="atlas-label">Prompt injection</text>\n'
    '\n'
    '  <rect x="378" y="188" width="116" height="22" fill="#888" class="cell"/>\n'
    '  <text x="436" y="202" class="tech">AML.T0054</text>\n'
    '  <text x="436" y="212" class="atlas-label">LLM jailbreak</text>\n'
    '\n'
    '  <rect x="610" y="188" width="116" height="22" fill="#777" class="cell"/>\n'
    '  <text x="668" y="202" class="tech">AML.T0056</text>\n'
    '  <text x="668" y="212" class="atlas-label">LLM prompt theft</text>\n'
    '\n'
    '  <!-- Legend -->\n'
    '  <line x1="20" y1="235" x2="880" y2="235" stroke="#000" stroke-width="0.5"/>\n'
    '  <rect x="30" y="245" width="20" height="12" fill="#d0d0d0" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="55" y="255" class="legend">Phase 1 (Recon.)</text>\n'
    '  <rect x="150" y="245" width="20" height="12" fill="#b8b8b8" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="175" y="255" class="legend">Phase 2 (Armement)</text>\n'
    '  <rect x="290" y="245" width="20" height="12" fill="#a0a0a0" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="315" y="255" class="legend">Phase 3 (Livraison)</text>\n'
    '  <rect x="430" y="245" width="20" height="12" fill="#888" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="455" y="255" class="legend">Phases 3–4 (Expl./Lat.)</text>\n'
    '  <rect x="590" y="245" width="20" height="12" fill="#666" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="615" y="255" class="legend">Phase 4 (C2/Exfil.)</text>\n'
    '  <rect x="730" y="245" width="20" height="12" fill="#555" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="755" y="255" class="legend">Phase 5 (Impact)</text>\n'
    '\n'
    '  <!-- Stats -->\n'
    '  <text x="30" y="278" class="legend" style="font-weight:bold;">Couverture : 14/14 tactiques ATT&amp;CK, ~35 techniques ATT&amp;CK, 4 techniques ATLAS</text>\n'
    '\n'
    '  <!-- Caption -->\n'
    '  <line x1="20" y1="290" x2="880" y2="290" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="20" y="308" class="caption"><tspan font-weight="bold">Figure 3.</tspan> Carte de couverture MITRE ATT&amp;CK et ATLAS pour l\'Opération OpenClaw. Chaque cellule représente une</text>\n'
    '  <text x="20" y="323" class="caption">technique utilisée dans le scénario, classée par tactique (colonnes) et colorée par phase (intensité croissante). La section</text>\n'
    '  <text x="20" y="338" class="caption">inférieure regroupe les techniques MITRE ATLAS spécifiques à l\'IA. L\'opération couvre l\'ensemble des 14 tactiques</text>\n'
    '  <text x="20" y="353" class="caption">ATT&amp;CK, illustrant la portée d\'une kill chain agentique de bout en bout.</text>\n'
    '</svg>\n'
)

# ────────────────────────────────────────────────────────────
# SVG ANGLAIS (modifiable)
# ────────────────────────────────────────────────────────────
SVG_EN = (
    '<?xml version="1.0" encoding="UTF-8"?>\n'
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="520" viewBox="0 0 900 520">\n'
    '  <style>\n'
    '    text { font-family: "Times New Roman", Times, serif; }\n'
    '    .title { font-size: 11px; font-weight: bold; text-anchor: middle; }\n'
    '    .tactic { font-size: 7.5px; font-weight: bold; text-anchor: middle; fill: #000; }\n'
    '    .tech { font-size: 6.5px; text-anchor: middle; fill: #333; font-family: "Courier New", monospace; }\n'
    '    .cell { stroke: #fff; stroke-width: 0.5; }\n'
    '    .caption { font-size: 10px; text-anchor: start; }\n'
    '    .legend { font-size: 7.5px; text-anchor: start; fill: #333; }\n'
    '    .atlas-label { font-size: 6.5px; text-anchor: middle; fill: #333; font-style: italic; }\n'
    '  </style>\n'
    '\n'
    '  <text x="450" y="20" class="title">MITRE ATT&amp;CK / ATLAS COVERAGE — OPERATION OPENCLAW</text>\n'
    '  <line x1="20" y1="28" x2="880" y2="28" stroke="#000" stroke-width="0.6"/>\n'
    '\n'
    '  <!-- 14 ATT&CK Tactics as columns -->\n'
    '  <!-- Col width ~58px, starting at x=30 -->\n'
    '  \n'
    '  <!-- Tactic headers -->\n'
    '  <text x="59" y="50" class="tactic">Recon.</text>\n'
    '  <text x="117" y="50" class="tactic">Res. Dev.</text>\n'
    '  <text x="175" y="50" class="tactic">Init. Acc.</text>\n'
    '  <text x="233" y="50" class="tactic">Execution</text>\n'
    '  <text x="291" y="50" class="tactic">Persist.</text>\n'
    '  <text x="349" y="50" class="tactic">Priv. Esc.</text>\n'
    '  <text x="407" y="50" class="tactic">Def. Ev.</text>\n'
    '  <text x="465" y="50" class="tactic">Cred. Acc.</text>\n'
    '  <text x="523" y="50" class="tactic">Discovery</text>\n'
    '  <text x="581" y="50" class="tactic">Lat. Mov.</text>\n'
    '  <text x="639" y="50" class="tactic">Collection</text>\n'
    '  <text x="697" y="50" class="tactic">C2</text>\n'
    '  <text x="755" y="50" class="tactic">Exfiltrat.</text>\n'
    '  <text x="813" y="50" class="tactic">Impact</text>\n'
    '\n'
    '  <!-- Phase 1 techniques (Reconnaissance) -->\n'
    '  <rect x="30" y="58" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="72" class="tech">T1593</text>\n'
    '  <rect x="30" y="80" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="94" class="tech">T1595</text>\n'
    '  <rect x="30" y="102" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="116" class="tech">T1596</text>\n'
    '  <rect x="30" y="124" width="58" height="22" fill="#d0d0d0" class="cell"/>\n'
    '  <text x="59" y="138" class="tech">T1589</text>\n'
    '\n'
    '  <!-- Phase 2 (Resource Development) -->\n'
    '  <rect x="88" y="58" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="72" class="tech">T1587.001</text>\n'
    '  <rect x="88" y="80" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="94" class="tech">T1588.002</text>\n'
    '  <rect x="88" y="102" width="58" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="117" y="116" class="tech">T1608</text>\n'
    '\n'
    '  <!-- Phase 3 (Initial Access) -->\n'
    '  <rect x="146" y="58" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="72" class="tech">T1195.002</text>\n'
    '  <rect x="146" y="80" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="94" class="tech">T1078</text>\n'
    '  <rect x="146" y="102" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="175" y="116" class="tech">T1190</text>\n'
    '\n'
    '  <!-- Execution -->\n'
    '  <rect x="204" y="58" width="58" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="233" y="72" class="tech">T1059</text>\n'
    '  <rect x="204" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="233" y="94" class="tech">T1204.002</text>\n'
    '\n'
    '  <!-- Persistence -->\n'
    '  <rect x="262" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="291" y="72" class="tech">T1546</text>\n'
    '  <rect x="262" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="291" y="94" class="tech">T1547</text>\n'
    '\n'
    '  <!-- Privilege Escalation -->\n'
    '  <rect x="320" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="349" y="72" class="tech">T1484.001</text>\n'
    '  <rect x="320" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="349" y="94" class="tech">T1558.001</text>\n'
    '\n'
    '  <!-- Defense Evasion -->\n'
    '  <rect x="378" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="407" y="72" class="tech">T1070</text>\n'
    '  <rect x="378" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="407" y="94" class="tech">T1036</text>\n'
    '\n'
    '  <!-- Credential Access -->\n'
    '  <rect x="436" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="72" class="tech">T1003.001</text>\n'
    '  <rect x="436" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="94" class="tech">T1003.006</text>\n'
    '  <rect x="436" y="102" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="465" y="116" class="tech">T1528</text>\n'
    '\n'
    '  <!-- Discovery -->\n'
    '  <rect x="494" y="58" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="72" class="tech">T1018</text>\n'
    '  <rect x="494" y="80" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="94" class="tech">T1083</text>\n'
    '  <rect x="494" y="102" width="58" height="22" fill="#888" class="cell"/>\n'
    '  <text x="523" y="116" class="tech">T1135</text>\n'
    '\n'
    '  <!-- Lateral Movement -->\n'
    '  <rect x="552" y="58" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="581" y="72" class="tech">T1021.002</text>\n'
    '  <rect x="552" y="80" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="581" y="94" class="tech">T1021.006</text>\n'
    '\n'
    '  <!-- Collection -->\n'
    '  <rect x="610" y="58" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="639" y="72" class="tech">T1005</text>\n'
    '  <rect x="610" y="80" width="58" height="22" fill="#777" class="cell"/>\n'
    '  <text x="639" y="94" class="tech">T1560</text>\n'
    '\n'
    '  <!-- C2 -->\n'
    '  <rect x="668" y="58" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="697" y="72" class="tech">T1071.001</text>\n'
    '  <rect x="668" y="80" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="697" y="94" class="tech">T1573</text>\n'
    '\n'
    '  <!-- Exfiltration -->\n'
    '  <rect x="726" y="58" width="58" height="22" fill="#666" class="cell"/>\n'
    '  <text x="755" y="72" class="tech">T1041</text>\n'
    '\n'
    '  <!-- Impact -->\n'
    '  <rect x="784" y="58" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="72" class="tech">T1486</text>\n'
    '  <rect x="784" y="80" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="94" class="tech">T1490</text>\n'
    '  <rect x="784" y="102" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="116" class="tech">T1657</text>\n'
    '  <rect x="784" y="124" width="58" height="22" fill="#555" class="cell"/>\n'
    '  <text x="813" y="138" class="tech">T1491.001</text>\n'
    '\n'
    '  <!-- ATLAS section -->\n'
    '  <line x1="20" y1="160" x2="880" y2="160" stroke="#000" stroke-width="0.5" stroke-dasharray="3,2"/>\n'
    '  <text x="450" y="178" class="tactic" style="font-size:8px;">MITRE ATLAS (AI-specific techniques)</text>\n'
    '\n'
    '  <rect x="88" y="188" width="116" height="22" fill="#b8b8b8" class="cell"/>\n'
    '  <text x="146" y="202" class="tech">AML.T0048</text>\n'
    '  <text x="146" y="212" class="atlas-label">Backdoor ML model</text>\n'
    '\n'
    '  <rect x="204" y="188" width="116" height="22" fill="#a0a0a0" class="cell"/>\n'
    '  <text x="262" y="202" class="tech">AML.T0051</text>\n'
    '  <text x="262" y="212" class="atlas-label">Prompt injection</text>\n'
    '\n'
    '  <rect x="378" y="188" width="116" height="22" fill="#888" class="cell"/>\n'
    '  <text x="436" y="202" class="tech">AML.T0054</text>\n'
    '  <text x="436" y="212" class="atlas-label">LLM jailbreak</text>\n'
    '\n'
    '  <rect x="610" y="188" width="116" height="22" fill="#777" class="cell"/>\n'
    '  <text x="668" y="202" class="tech">AML.T0056</text>\n'
    '  <text x="668" y="212" class="atlas-label">LLM prompt theft</text>\n'
    '\n'
    '  <!-- Legend -->\n'
    '  <line x1="20" y1="235" x2="880" y2="235" stroke="#000" stroke-width="0.5"/>\n'
    '  <rect x="30" y="245" width="20" height="12" fill="#d0d0d0" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="55" y="255" class="legend">Phase 1 (Recon.)</text>\n'
    '  <rect x="150" y="245" width="20" height="12" fill="#b8b8b8" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="175" y="255" class="legend">Phase 2 (Weaponiz.)</text>\n'
    '  <rect x="290" y="245" width="20" height="12" fill="#a0a0a0" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="315" y="255" class="legend">Phase 3 (Delivery)</text>\n'
    '  <rect x="430" y="245" width="20" height="12" fill="#888" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="455" y="255" class="legend">Phases 3–4 (Expl./Lat.)</text>\n'
    '  <rect x="590" y="245" width="20" height="12" fill="#666" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="615" y="255" class="legend">Phase 4 (C2/Exfil.)</text>\n'
    '  <rect x="730" y="245" width="20" height="12" fill="#555" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="755" y="255" class="legend">Phase 5 (Impact)</text>\n'
    '\n'
    '  <!-- Stats -->\n'
    '  <text x="30" y="278" class="legend" style="font-weight:bold;">Coverage: 14/14 ATT&amp;CK tactics, ~35 ATT&amp;CK techniques, 4 ATLAS techniques</text>\n'
    '\n'
    '  <!-- Caption -->\n'
    '  <line x1="20" y1="290" x2="880" y2="290" stroke="#000" stroke-width="0.5"/>\n'
    '  <text x="20" y="308" class="caption"><tspan font-weight="bold">Figure 3.</tspan> MITRE coverage map for ATT&amp;CK et ATLAS Operation OpenClaw. Each cell represents a</text>\n'
    '  <text x="20" y="323" class="caption">technique used in the scenario, classified by tactic (columns) and colored by phase (increasing intensity). The lower</text>\n'
    '  <text x="20" y="338" class="caption">section groups AI-specific MITRE ATLAS techniques. The operation covers all 14</text>\n'
    '  <text x="20" y="353" class="caption">ATT&amp;CK tactics, illustrating the scope of an end-to-end agentic kill chain.</text>\n'
    '</svg>\n'
)


def generate(lang=None):
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    targets = []
    if lang != "en":
        targets.append(("FR", SVG_FR))
    if lang != "fr":
        targets.append(("EN", SVG_EN))
    for suffix, svg in targets:
        name = f"Figure03_HEATMAP_{suffix}.png"
        path = os.path.join(OUTPUT_DIR, name)
        cairosvg.svg2png(bytestring=svg.encode("utf-8"), write_to=path, dpi=DPI, output_width=WIDTH)
        print(f"  \u2713 {name} ({os.path.getsize(path)//1024} KB)")


if __name__ == "__main__":
    lang = sys.argv[1].lower() if len(sys.argv) > 1 else None
    generate(lang)
