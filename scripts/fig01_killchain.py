#!/usr/bin/env python3
"""
OpenClaw — Figure 01 : KillChain
========================================
Generates Figure01_KillChain_FR.png and Figure01_KillChain_EN.png

EDIT: Change text directly in SVG_FR / SVG_EN below.

Usage:
    python3 fig01_killchain.py              # FR + EN
    python3 fig01_killchain.py fr           # FR only
    python3 fig01_killchain.py en           # EN only

Requires: pip install cairosvg
"""

import os, sys

try:
    import cairosvg
except ImportError:
    print("pip install cairosvg")
    sys.exit(1)

OUTPUT_DIR = os.path.join(os.path.dirname(os.path.abspath(__file__)), "openclaw_figures")
DPI = 300
WIDTH = 3600

# ────────────────────────────────────────────────────────────
# SVG FRANÇAIS (modifiable)
# ────────────────────────────────────────────────────────────
SVG_FR = (
    '<?xml version="1.0" encoding="UTF-8"?>\n'
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="620" viewBox="0 0 900 620">\n'
    '  <style>\n'
    '    text { font-family: "Times New Roman", Times, serif; }\n'
    '    .phase-box { fill: none; stroke: #000; stroke-width: 1.2; }\n'
    '    .phase-label { font-size: 11px; font-weight: bold; text-anchor: middle; }\n'
    '    .phase-sub { font-size: 9px; text-anchor: middle; fill: #333; }\n'
    '    .phase-num { font-size: 9px; text-anchor: middle; fill: #666; font-style: italic; }\n'
    '    .arrow { fill: none; stroke: #000; stroke-width: 1; marker-end: url(#arrowhead); }\n'
    '    .bracket-line { fill: none; stroke: #555; stroke-width: 0.8; stroke-dasharray: 3,2; }\n'
    '    .caption { font-size: 10px; text-anchor: start; }\n'
    '    .caption-bold { font-size: 10px; text-anchor: start; font-weight: bold; }\n'
    '    .header { font-size: 9px; text-anchor: middle; font-weight: bold; fill: #000; }\n'
    '    .mitre-tag { font-size: 8px; text-anchor: middle; fill: #444; font-family: "Courier New", monospace; }\n'
    '    .defense-text { font-size: 8px; text-anchor: middle; fill: #333; }\n'
    '    .ia-text { font-size: 8.5px; text-anchor: middle; fill: #000; }\n'
    '    .phase-fill-light { fill: #f5f5f5; stroke: #000; stroke-width: 1.2; }\n'
    '    .phase-fill-dark { fill: #e0e0e0; stroke: #000; stroke-width: 1.2; }\n'
    '    .timeline-text { font-size: 8px; text-anchor: middle; fill: #555; font-style: italic; }\n'
    '  </style>\n'
    '  \n'
    '  <defs>\n'
    '    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">\n'
    '      <polygon points="0 0, 8 3, 0 6" fill="#000"/>\n'
    '    </marker>\n'
    '    <marker id="arrowhead-gray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">\n'
    '      <polygon points="0 0, 8 3, 0 6" fill="#888"/>\n'
    '    </marker>\n'
    '  </defs>\n'
    '\n'
    '  <!-- Column headers -->\n'
    '  <text x="450" y="22" class="header" style="font-size:11px;">OPÉRATION OPENCLAW — CORRÉLATION AVEC LA CYBER KILL CHAIN (LOCKHEED MARTIN)</text>\n'
    '  \n'
    '  <line x1="30" y1="30" x2="870" y2="30" stroke="#000" stroke-width="0.8"/>\n'
    '  \n'
    '  <!-- Row headers -->\n'
    '  <text x="450" y="50" class="header">Étape</text>\n'
    '  <text x="450" y="105" class="header">Vecteur IA</text>\n'
    '  <text x="450" y="195" class="header">Techniques MITRE</text>\n'
    '  <text x="450" y="275" class="header">Contrôle défensif</text>\n'
    '\n'
    '  <!-- 7 columns for 7 kill chain stages -->\n'
    '  <!-- Column positions: 30, 150, 270, 390, 510, 630, 750 → each 120px wide -->\n'
    '  \n'
    '  <!-- Stage boxes row -->\n'
    '  <!-- 1. Reconnaissance -->\n'
    '  <rect x="32" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="87" y="72" class="phase-label" style="font-size:9px;">1. Reconnaissance</text>\n'
    '  <text x="87" y="82" class="timeline-text">J−30 à J−15</text>\n'
    '  \n'
    '  <!-- 2. Weaponization -->\n'
    '  <rect x="152" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="207" y="72" class="phase-label" style="font-size:9px;">2. Weaponization</text>\n'
    '  <text x="207" y="82" class="timeline-text">J−15 à J−7</text>\n'
    '  \n'
    '  <!-- 3. Delivery -->\n'
    '  <rect x="272" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="327" y="72" class="phase-label" style="font-size:9px;">3. Delivery</text>\n'
    '  <text x="327" y="82" class="timeline-text">J−7 à J</text>\n'
    '  \n'
    '  <!-- 4. Exploitation -->\n'
    '  <rect x="392" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="447" y="72" class="phase-label" style="font-size:9px;">4. Exploitation</text>\n'
    '  <text x="447" y="82" class="timeline-text">Jour J</text>\n'
    '  \n'
    '  <!-- 5. Installation -->\n'
    '  <rect x="512" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="567" y="72" class="phase-label" style="font-size:9px;">5. Installation</text>\n'
    '  <text x="567" y="82" class="timeline-text">J à J+1</text>\n'
    '  \n'
    '  <!-- 6. C2 -->\n'
    '  <rect x="632" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="687" y="72" class="phase-label" style="font-size:9px;">6. Command</text>\n'
    '  <text x="687" y="82" class="timeline-text">J+1 à J+5</text>\n'
    '  \n'
    '  <!-- 7. Actions -->\n'
    '  <rect x="752" y="58" width="110" height="32" class="phase-fill-dark"/>\n'
    '  <text x="807" y="72" class="phase-label" style="font-size:9px;">7. Actions on Obj.</text>\n'
    '  <text x="807" y="82" class="timeline-text">J+6</text>\n'
    '\n'
    '  <!-- Arrows between stages -->\n'
    '  <line x1="142" y1="74" x2="150" y2="74" class="arrow"/>\n'
    '  <line x1="262" y1="74" x2="270" y2="74" class="arrow"/>\n'
    '  <line x1="382" y1="74" x2="390" y2="74" class="arrow"/>\n'
    '  <line x1="502" y1="74" x2="510" y2="74" class="arrow"/>\n'
    '  <line x1="622" y1="74" x2="630" y2="74" class="arrow"/>\n'
    '  <line x1="742" y1="74" x2="750" y2="74" class="arrow"/>\n'
    '\n'
    '  <!-- IA Vector row -->\n'
    '  <text x="87" y="115" class="ia-text">OSINT automatisée</text>\n'
    '  <text x="87" y="126" class="ia-text">(Shodan, social</text>\n'
    '  <text x="87" y="137" class="ia-text">graph mining)</text>\n'
    '  \n'
    '  <text x="207" y="115" class="ia-text">Skill piégée,</text>\n'
    '  <text x="207" y="126" class="ia-text">PromptLock</text>\n'
    '  <text x="207" y="137" class="ia-text">(Go + LLM local)</text>\n'
    '  \n'
    '  <text x="327" y="115" class="ia-text">Supply chain skill,</text>\n'
    '  <text x="327" y="126" class="ia-text">infostealer,</text>\n'
    '  <text x="327" y="137" class="ia-text">CVE-2024-55591</text>\n'
    '  \n'
    '  <text x="447" y="115" class="ia-text">Exécution skill</text>\n'
    '  <text x="447" y="126" class="ia-text">dans contexte</text>\n'
    '  <text x="447" y="137" class="ia-text">agent</text>\n'
    '  \n'
    '  <text x="567" y="115" class="ia-text">HEARTBEAT.md,</text>\n'
    '  <text x="567" y="126" class="ia-text">mémoire empois.,</text>\n'
    '  <text x="567" y="137" class="ia-text">tokens volés</text>\n'
    '  \n'
    '  <text x="687" y="115" class="ia-text">Canal HTTPS</text>\n'
    '  <text x="687" y="126" class="ia-text">camouflé dans</text>\n'
    '  <text x="687" y="137" class="ia-text">trafic API agent</text>\n'
    '  \n'
    '  <text x="807" y="115" class="ia-text">PromptLock +</text>\n'
    '  <text x="807" y="126" class="ia-text">double extorsion</text>\n'
    '  <text x="807" y="137" class="ia-text">(T1486, T1657)</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="150" x2="870" y2="150" stroke="#999" stroke-width="0.5" stroke-dasharray="2,2"/>\n'
    '\n'
    '  <!-- MITRE row -->\n'
    '  <text x="87" y="170" class="mitre-tag">T1593 T1595</text>\n'
    '  <text x="87" y="181" class="mitre-tag">T1596</text>\n'
    '  \n'
    '  <text x="207" y="170" class="mitre-tag">T1587.001</text>\n'
    '  <text x="207" y="181" class="mitre-tag">AML.T0048</text>\n'
    '  \n'
    '  <text x="327" y="170" class="mitre-tag">T1195.002</text>\n'
    '  <text x="327" y="181" class="mitre-tag">T1078</text>\n'
    '  \n'
    '  <text x="447" y="170" class="mitre-tag">T1059</text>\n'
    '  <text x="447" y="181" class="mitre-tag">AML.T0051</text>\n'
    '  \n'
    '  <text x="567" y="170" class="mitre-tag">T1546</text>\n'
    '  <text x="567" y="181" class="mitre-tag">T1528</text>\n'
    '  \n'
    '  <text x="687" y="170" class="mitre-tag">T1041</text>\n'
    '  <text x="687" y="181" class="mitre-tag">T1071.001</text>\n'
    '  \n'
    '  <text x="807" y="170" class="mitre-tag">T1486 T1490</text>\n'
    '  <text x="807" y="181" class="mitre-tag">T1657 T1484.001</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="200" x2="870" y2="200" stroke="#999" stroke-width="0.5" stroke-dasharray="2,2"/>\n'
    '\n'
    '  <!-- Defense row -->\n'
    '  <text x="87" y="218" class="defense-text">Réduction</text>\n'
    '  <text x="87" y="228" class="defense-text">empreinte</text>\n'
    '  <text x="87" y="238" class="defense-text">publique</text>\n'
    '  \n'
    '  <text x="207" y="218" class="defense-text">Revue de code,</text>\n'
    '  <text x="207" y="228" class="defense-text">signature skills,</text>\n'
    '  <text x="207" y="238" class="defense-text">allowlist éditeurs</text>\n'
    '  \n'
    '  <text x="327" y="218" class="defense-text">Patch KEV,</text>\n'
    '  <text x="327" y="228" class="defense-text">MFA résistante,</text>\n'
    '  <text x="327" y="238" class="defense-text">sandboxing</text>\n'
    '  \n'
    '  <text x="447" y="218" class="defense-text">Allowlist outils,</text>\n'
    '  <text x="447" y="228" class="defense-text">restrictions</text>\n'
    '  <text x="447" y="238" class="defense-text">permissions</text>\n'
    '  \n'
    '  <text x="567" y="218" class="defense-text">Gouvernance</text>\n'
    '  <text x="567" y="228" class="defense-text">mémoire, rotation</text>\n'
    '  <text x="567" y="238" class="defense-text">tokens</text>\n'
    '  \n'
    '  <text x="687" y="218" class="defense-text">Allowlist egress,</text>\n'
    '  <text x="687" y="228" class="defense-text">DLP, inspection</text>\n'
    '  <text x="687" y="238" class="defense-text">TLS</text>\n'
    '  \n'
    '  <text x="807" y="218" class="defense-text">Sauvegardes</text>\n'
    '  <text x="807" y="228" class="defense-text">immuables,</text>\n'
    '  <text x="807" y="238" class="defense-text">3-2-1-1-0</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="260" x2="870" y2="260" stroke="#000" stroke-width="0.8"/>\n'
    '\n'
    '  <!-- Phase mapping brackets below -->\n'
    '  <text x="450" y="282" class="header">Correspondance avec les phases narratives du rapport</text>\n'
    '  \n'
    '  <!-- Phase 1 bracket -->\n'
    '  <line x1="32" y1="292" x2="142" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="32" y1="288" x2="32" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="142" y1="288" x2="142" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="87" y="306" class="phase-num">Phase 1</text>\n'
    '  \n'
    '  <!-- Phase 2 bracket -->\n'
    '  <line x1="152" y1="292" x2="262" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="152" y1="288" x2="152" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="262" y1="288" x2="262" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="207" y="306" class="phase-num">Phase 2</text>\n'
    '  \n'
    '  <!-- Phase 3 bracket (spans Delivery + Exploitation + Installation) -->\n'
    '  <line x1="272" y1="292" x2="622" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="272" y1="288" x2="272" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="622" y1="288" x2="622" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="447" y="306" class="phase-num">Phase 3 (Livraison + Exploitation + Installation)</text>\n'
    '  \n'
    '  <!-- Phase 4 bracket (C2) -->\n'
    '  <line x1="632" y1="292" x2="742" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="632" y1="288" x2="632" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="742" y1="288" x2="742" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="687" y="306" class="phase-num">Phase 4</text>\n'
    '  \n'
    '  <!-- Phase 5 bracket -->\n'
    '  <line x1="752" y1="292" x2="862" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="752" y1="288" x2="752" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="862" y1="288" x2="862" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="807" y="306" class="phase-num">Phase 5</text>\n'
    '\n'
    '  <!-- Vertical separators between columns -->\n'
    '  <line x1="147" y1="55" x2="147" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="267" y1="55" x2="267" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="387" y1="55" x2="387" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="507" y1="55" x2="507" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="627" y1="55" x2="627" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="747" y1="55" x2="747" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '\n'
    '  <!-- Figure caption -->\n'
    '  <line x1="30" y1="325" x2="870" y2="325" stroke="#000" stroke-width="0.5"/>\n'
    '  \n'
    '  <text x="30" y="345" class="caption">\n'
    '    <tspan font-weight="bold">Figure 1.</tspan> Corrélation de l\'Opération OpenClaw avec les sept étapes de la Cyber Kill Chain de Lockheed Martin [1].\n'
    '  </text>\n'
    '  <text x="30" y="360" class="caption">Pour chaque étape : le vecteur IA exploité, les techniques MITRE ATT&amp;CK/ATLAS correspondantes, et le contrôle défensif prioritaire.</text>\n'
    '  <text x="30" y="375" class="caption">Les accolades inférieures montrent la correspondance avec les cinq phases narratives du rapport. La Phase 3 couvre trois</text>\n'
    '  <text x="30" y="390" class="caption">étapes de la Kill Chain (Delivery, Exploitation, Installation), ce qui reflète le chevauchement temporel de ces actions dans le scénario.</text>\n'
    '  <text x="30" y="405" class="caption">L\'étape 7 (fond grisé) représente l\'objectif final de l\'opération.</text>\n'
    '  \n'
    '</svg>\n'
)

# ────────────────────────────────────────────────────────────
# SVG ANGLAIS (modifiable)
# ────────────────────────────────────────────────────────────
SVG_EN = (
    '<?xml version="1.0" encoding="UTF-8"?>\n'
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="620" viewBox="0 0 900 620">\n'
    '  <style>\n'
    '    text { font-family: "Times New Roman", Times, serif; }\n'
    '    .phase-box { fill: none; stroke: #000; stroke-width: 1.2; }\n'
    '    .phase-label { font-size: 11px; font-weight: bold; text-anchor: middle; }\n'
    '    .phase-sub { font-size: 9px; text-anchor: middle; fill: #333; }\n'
    '    .phase-num { font-size: 9px; text-anchor: middle; fill: #666; font-style: italic; }\n'
    '    .arrow { fill: none; stroke: #000; stroke-width: 1; marker-end: url(#arrowhead); }\n'
    '    .caption { font-size: 10px; text-anchor: start; }\n'
    '    .header { font-size: 9px; text-anchor: middle; font-weight: bold; fill: #000; }\n'
    '    .mitre-tag { font-size: 8px; text-anchor: middle; fill: #444; font-family: "Courier New", monospace; }\n'
    '    .defense-text { font-size: 8px; text-anchor: middle; fill: #333; }\n'
    '    .ia-text { font-size: 8.5px; text-anchor: middle; fill: #000; }\n'
    '    .phase-fill-light { fill: #f5f5f5; stroke: #000; stroke-width: 1.2; }\n'
    '    .phase-fill-dark { fill: #e0e0e0; stroke: #000; stroke-width: 1.2; }\n'
    '    .timeline-text { font-size: 8px; text-anchor: middle; fill: #555; font-style: italic; }\n'
    '  </style>\n'
    '  \n'
    '  <defs>\n'
    '    <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">\n'
    '      <polygon points="0 0, 8 3, 0 6" fill="#000"/>\n'
    '    </marker>\n'
    '  </defs>\n'
    '\n'
    '  <!-- Title -->\n'
    '  <text x="450" y="22" class="header" style="font-size:11px;">OPERATION OPENCLAW — MAPPING TO THE LOCKHEED MARTIN CYBER KILL CHAIN</text>\n'
    '  \n'
    '  <line x1="30" y1="30" x2="870" y2="30" stroke="#000" stroke-width="0.8"/>\n'
    '  \n'
    '  <!-- Row headers -->\n'
    '  <text x="450" y="50" class="header">Stage</text>\n'
    '  <text x="450" y="105" class="header">AI Vector</text>\n'
    '  <text x="450" y="195" class="header">MITRE Techniques</text>\n'
    '  <text x="450" y="275" class="header">Defensive Control</text>\n'
    '\n'
    '  <!-- Stage boxes -->\n'
    '  <!-- 1. Reconnaissance -->\n'
    '  <rect x="32" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="87" y="72" class="phase-label" style="font-size:9px;">1. Reconnaissance</text>\n'
    '  <text x="87" y="82" class="timeline-text">D−30 to D−15</text>\n'
    '  \n'
    '  <!-- 2. Weaponization -->\n'
    '  <rect x="152" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="207" y="72" class="phase-label" style="font-size:9px;">2. Weaponization</text>\n'
    '  <text x="207" y="82" class="timeline-text">D−15 to D−7</text>\n'
    '  \n'
    '  <!-- 3. Delivery -->\n'
    '  <rect x="272" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="327" y="72" class="phase-label" style="font-size:9px;">3. Delivery</text>\n'
    '  <text x="327" y="82" class="timeline-text">D−7 to D</text>\n'
    '  \n'
    '  <!-- 4. Exploitation -->\n'
    '  <rect x="392" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="447" y="72" class="phase-label" style="font-size:9px;">4. Exploitation</text>\n'
    '  <text x="447" y="82" class="timeline-text">Day D</text>\n'
    '  \n'
    '  <!-- 5. Installation -->\n'
    '  <rect x="512" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="567" y="72" class="phase-label" style="font-size:9px;">5. Installation</text>\n'
    '  <text x="567" y="82" class="timeline-text">D to D+1</text>\n'
    '  \n'
    '  <!-- 6. C2 -->\n'
    '  <rect x="632" y="58" width="110" height="32" class="phase-fill-light"/>\n'
    '  <text x="687" y="72" class="phase-label" style="font-size:9px;">6. Command</text>\n'
    '  <text x="687" y="82" class="timeline-text">D+1 to D+5</text>\n'
    '  \n'
    '  <!-- 7. Actions -->\n'
    '  <rect x="752" y="58" width="110" height="32" class="phase-fill-dark"/>\n'
    '  <text x="807" y="72" class="phase-label" style="font-size:9px;">7. Actions on Obj.</text>\n'
    '  <text x="807" y="82" class="timeline-text">D+6</text>\n'
    '\n'
    '  <!-- Arrows between stages -->\n'
    '  <line x1="142" y1="74" x2="150" y2="74" class="arrow"/>\n'
    '  <line x1="262" y1="74" x2="270" y2="74" class="arrow"/>\n'
    '  <line x1="382" y1="74" x2="390" y2="74" class="arrow"/>\n'
    '  <line x1="502" y1="74" x2="510" y2="74" class="arrow"/>\n'
    '  <line x1="622" y1="74" x2="630" y2="74" class="arrow"/>\n'
    '  <line x1="742" y1="74" x2="750" y2="74" class="arrow"/>\n'
    '\n'
    '  <!-- AI Vector row -->\n'
    '  <text x="87" y="115" class="ia-text">Automated OSINT</text>\n'
    '  <text x="87" y="126" class="ia-text">(Shodan, social</text>\n'
    '  <text x="87" y="137" class="ia-text">graph mining)</text>\n'
    '  \n'
    '  <text x="207" y="115" class="ia-text">Trojanized skill,</text>\n'
    '  <text x="207" y="126" class="ia-text">PromptLock</text>\n'
    '  <text x="207" y="137" class="ia-text">(Go + local LLM)</text>\n'
    '  \n'
    '  <text x="327" y="115" class="ia-text">Skill supply chain,</text>\n'
    '  <text x="327" y="126" class="ia-text">infostealer,</text>\n'
    '  <text x="327" y="137" class="ia-text">CVE-2024-55591</text>\n'
    '  \n'
    '  <text x="447" y="115" class="ia-text">Skill execution</text>\n'
    '  <text x="447" y="126" class="ia-text">within agent</text>\n'
    '  <text x="447" y="137" class="ia-text">context</text>\n'
    '  \n'
    '  <text x="567" y="115" class="ia-text">HEARTBEAT.md,</text>\n'
    '  <text x="567" y="126" class="ia-text">memory poisoning,</text>\n'
    '  <text x="567" y="137" class="ia-text">stolen tokens</text>\n'
    '  \n'
    '  <text x="687" y="115" class="ia-text">HTTPS channel</text>\n'
    '  <text x="687" y="126" class="ia-text">blended with</text>\n'
    '  <text x="687" y="137" class="ia-text">agent API traffic</text>\n'
    '  \n'
    '  <text x="807" y="115" class="ia-text">PromptLock +</text>\n'
    '  <text x="807" y="126" class="ia-text">double extortion</text>\n'
    '  <text x="807" y="137" class="ia-text">(T1486, T1657)</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="150" x2="870" y2="150" stroke="#999" stroke-width="0.5" stroke-dasharray="2,2"/>\n'
    '\n'
    '  <!-- MITRE row -->\n'
    '  <text x="87" y="170" class="mitre-tag">T1593 T1595</text>\n'
    '  <text x="87" y="181" class="mitre-tag">T1596</text>\n'
    '  \n'
    '  <text x="207" y="170" class="mitre-tag">T1587.001</text>\n'
    '  <text x="207" y="181" class="mitre-tag">AML.T0048</text>\n'
    '  \n'
    '  <text x="327" y="170" class="mitre-tag">T1195.002</text>\n'
    '  <text x="327" y="181" class="mitre-tag">T1078</text>\n'
    '  \n'
    '  <text x="447" y="170" class="mitre-tag">T1059</text>\n'
    '  <text x="447" y="181" class="mitre-tag">AML.T0051</text>\n'
    '  \n'
    '  <text x="567" y="170" class="mitre-tag">T1546</text>\n'
    '  <text x="567" y="181" class="mitre-tag">T1528</text>\n'
    '  \n'
    '  <text x="687" y="170" class="mitre-tag">T1041</text>\n'
    '  <text x="687" y="181" class="mitre-tag">T1071.001</text>\n'
    '  \n'
    '  <text x="807" y="170" class="mitre-tag">T1486 T1490</text>\n'
    '  <text x="807" y="181" class="mitre-tag">T1657 T1484.001</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="200" x2="870" y2="200" stroke="#999" stroke-width="0.5" stroke-dasharray="2,2"/>\n'
    '\n'
    '  <!-- Defense row -->\n'
    '  <text x="87" y="218" class="defense-text">Public footprint</text>\n'
    '  <text x="87" y="228" class="defense-text">reduction,</text>\n'
    '  <text x="87" y="238" class="defense-text">banner hardening</text>\n'
    '  \n'
    '  <text x="207" y="218" class="defense-text">Code review,</text>\n'
    '  <text x="207" y="228" class="defense-text">skill signing,</text>\n'
    '  <text x="207" y="238" class="defense-text">publisher allowlist</text>\n'
    '  \n'
    '  <text x="327" y="218" class="defense-text">KEV patching,</text>\n'
    '  <text x="327" y="228" class="defense-text">phishing-resistant</text>\n'
    '  <text x="327" y="238" class="defense-text">MFA, sandboxing</text>\n'
    '  \n'
    '  <text x="447" y="218" class="defense-text">Tool allowlist,</text>\n'
    '  <text x="447" y="228" class="defense-text">permission</text>\n'
    '  <text x="447" y="238" class="defense-text">restrictions</text>\n'
    '  \n'
    '  <text x="567" y="218" class="defense-text">Memory</text>\n'
    '  <text x="567" y="228" class="defense-text">governance,</text>\n'
    '  <text x="567" y="238" class="defense-text">token rotation</text>\n'
    '  \n'
    '  <text x="687" y="218" class="defense-text">Egress allowlist,</text>\n'
    '  <text x="687" y="228" class="defense-text">DLP, TLS</text>\n'
    '  <text x="687" y="238" class="defense-text">inspection</text>\n'
    '  \n'
    '  <text x="807" y="218" class="defense-text">Immutable</text>\n'
    '  <text x="807" y="228" class="defense-text">backups,</text>\n'
    '  <text x="807" y="238" class="defense-text">3-2-1-1-0 rule</text>\n'
    '\n'
    '  <!-- Separator -->\n'
    '  <line x1="30" y1="260" x2="870" y2="260" stroke="#000" stroke-width="0.8"/>\n'
    '\n'
    '  <!-- Phase mapping brackets -->\n'
    '  <text x="450" y="282" class="header">Mapping to report narrative phases</text>\n'
    '  \n'
    '  <!-- Phase 1 -->\n'
    '  <line x1="32" y1="292" x2="142" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="32" y1="288" x2="32" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="142" y1="288" x2="142" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="87" y="306" class="phase-num">Phase 1</text>\n'
    '  \n'
    '  <!-- Phase 2 -->\n'
    '  <line x1="152" y1="292" x2="262" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="152" y1="288" x2="152" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="262" y1="288" x2="262" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="207" y="306" class="phase-num">Phase 2</text>\n'
    '  \n'
    '  <!-- Phase 3 -->\n'
    '  <line x1="272" y1="292" x2="622" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="272" y1="288" x2="272" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="622" y1="288" x2="622" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="447" y="306" class="phase-num">Phase 3 (Delivery + Exploitation + Installation)</text>\n'
    '  \n'
    '  <!-- Phase 4 -->\n'
    '  <line x1="632" y1="292" x2="742" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="632" y1="288" x2="632" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="742" y1="288" x2="742" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="687" y="306" class="phase-num">Phase 4</text>\n'
    '  \n'
    '  <!-- Phase 5 -->\n'
    '  <line x1="752" y1="292" x2="862" y2="292" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="752" y1="288" x2="752" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <line x1="862" y1="288" x2="862" y2="296" stroke="#000" stroke-width="1"/>\n'
    '  <text x="807" y="306" class="phase-num">Phase 5</text>\n'
    '\n'
    '  <!-- Vertical separators -->\n'
    '  <line x1="147" y1="55" x2="147" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="267" y1="55" x2="267" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="387" y1="55" x2="387" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="507" y1="55" x2="507" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="627" y1="55" x2="627" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '  <line x1="747" y1="55" x2="747" y2="260" stroke="#ddd" stroke-width="0.5"/>\n'
    '\n'
    '  <!-- Caption -->\n'
    '  <line x1="30" y1="325" x2="870" y2="325" stroke="#000" stroke-width="0.5"/>\n'
    '  \n'
    '  <text x="30" y="345" class="caption">\n'
    '    <tspan font-weight="bold">Figure 1.</tspan> Operation OpenClaw mapped to the seven stages of the Lockheed Martin Cyber Kill Chain [1].\n'
    '  </text>\n'
    '  <text x="30" y="360" class="caption">Each stage shows the AI vector leveraged, the corresponding MITRE ATT&amp;CK/ATLAS techniques, and the priority defensive control.</text>\n'
    '  <text x="30" y="375" class="caption">Bottom brackets indicate the mapping to the five narrative phases of the report. Phase 3 spans three Kill Chain stages</text>\n'
    '  <text x="30" y="390" class="caption">(Delivery, Exploitation, Installation), reflecting the temporal overlap of these actions in the scenario.</text>\n'
    '  <text x="30" y="405" class="caption">Stage 7 (darker background) represents the final objective of the operation.</text>\n'
    '  \n'
    '</svg>\n'
)


def generate(lang=None):
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    targets = []
    if lang != "en":
        targets.append(("FR", SVG_FR))
    if lang != "fr":
        targets.append(("EN", SVG_EN))
    for suffix, svg in targets:
        name = f"Figure01_KillChain_{suffix}.png"
        path = os.path.join(OUTPUT_DIR, name)
        cairosvg.svg2png(bytestring=svg.encode("utf-8"), write_to=path, dpi=DPI, output_width=WIDTH)
        print(f"  \u2713 {name} ({os.path.getsize(path)//1024} KB)")


if __name__ == "__main__":
    lang = sys.argv[1].lower() if len(sys.argv) > 1 else None
    generate(lang)
